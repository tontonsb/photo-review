import{I as V,c as ie,d as $,e as fe,h as we,i as re,j as w,k as T,l as k,r as _e,m as Ee,E as K,u as xe,n as ye,S as Ie,o as ve,p as te,q as Se,s as W,t as C,v as Re,B as D,w as ae,x as Le,y as oe,L as be,C as Ce,z as se,A as ne,D as Ae,F as Me,H as Te,J as M,K as P,f as v,N as q,O as ke,P as De,Q as le,R as ce,b as O,V as U,G as Fe,M as F,T as ue,X as he,a as L,U as X,W as Ge,g as H,Y as Ne,Z as je,_ as Y,$ as We,a0 as Pe,a1 as ge}from"./XYZ-DsNBlP0r.js";function B(u){return Array.isArray(u)?Math.min(...u):u}class Oe extends V{constructor(e,t,i,s,r,n,a){let o=e.getExtent();o&&e.canWrapX()&&(o=o.slice(),o[0]=-1/0,o[2]=1/0);let c=t.getExtent();c&&t.canWrapX()&&(c=c.slice(),c[0]=-1/0,c[2]=1/0);const l=c?ie(i,c):i,d=$(l),g=fe(e,t,d,s),h=ye,m=new we(e,t,l,o,g*h,s),x=m.calculateSourceExtent(),f=re(x)?null:n(x,g,r),_=f?w.IDLE:w.EMPTY,p=f?f.getPixelRatio():1;super(i,s,p,_),this.targetProj_=t,this.maxSourceExtent_=o,this.triangulation_=m,this.targetResolution_=s,this.targetExtent_=i,this.sourceImage_=f,this.sourcePixelRatio_=p,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==w.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==w.LOADED){const t=T(this.targetExtent_)/this.targetResolution_,i=k(this.targetExtent_)/this.targetResolution_;this.canvas_=_e(t,i,this.sourcePixelRatio_,B(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=e,this.changed()}load(){if(this.state==w.IDLE){this.state=w.LOADING,this.changed();const e=this.sourceImage_.getState();e==w.LOADED||e==w.ERROR?this.reproject_():(this.sourceListenerKey_=Ee(this.sourceImage_,K.CHANGE,function(t){const i=this.sourceImage_.getState();(i==w.LOADED||i==w.ERROR)&&(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}}unlistenSource_(){xe(this.sourceListenerKey_),this.sourceListenerKey_=null}}const A=4,N={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class Ue extends D{constructor(e,t){super(e),this.image=t}}class He extends Ie{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:e.interpolate!==void 0?e.interpolate:!0}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=e.resolutions!==void 0?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=e.loader?e.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const t=this.getResolutions();if(t){const i=ve(t,e,0);e=t[i]}return e}getImage(e,t,i,s){const r=this.getProjection();if(!r||!s||te(r,s))return r&&(s=r),this.getImageInternal(e,t,i,s);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&te(this.reprojectedImage_.getProjection(),s)&&this.reprojectedImage_.getResolution()==t&&Se(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new Oe(r,s,e,t,i,(n,a,o)=>this.getImageInternal(n,a,o,r),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,t,i,s){if(this.loader){const r=Ve(e,t,i,1),n=this.findNearestResolution(t);if(this.image&&(this.static_||this.wantedProjection_===s&&(this.wantedExtent_&&W(this.wantedExtent_,r)||W(this.image.getExtent(),r))&&(this.wantedResolution_&&B(this.wantedResolution_)===n||B(this.image.getResolution())===n)))return this.image;this.wantedProjection_=s,this.wantedExtent_=r,this.wantedResolution_=n,this.image=new V(r,n,i,this.loader),this.image.addEventListener(K.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){const t=e.target;let i;switch(t.getState()){case w.LOADING:this.loading=!0,i=N.IMAGELOADSTART;break;case w.LOADED:this.loading=!1,i=N.IMAGELOADEND;break;case w.ERROR:this.loading=!1,i=N.IMAGELOADERROR;break;default:return}this.hasListener(i)&&this.dispatchEvent(new Ue(i,t))}}function Be(u,e){u.getImage().src=e}function Ve(u,e,t,i){const s=e/t,r=$(u),n=C(T(u)/s,A),a=C(k(u)/s,A),o=C((i-1)*n/2,A),c=n+2*o,l=C((i-1)*a/2,A),d=a+2*l;return Re(r,s,0,[c,d])}function $e(u){const e=u.load||ae,t=u.imageExtent,i=new Image;return u.crossOrigin!==null&&(i.crossOrigin=u.crossOrigin),()=>e(i,u.url).then(s=>{const r=T(t)/s.width,n=k(t)/s.height;return{image:s,extent:t,resolution:r!==n?[r,n]:n,pixelRatio:1}})}class z extends He{constructor(e){const t=e.crossOrigin!==void 0?e.crossOrigin:null,i=e.imageLoadFunction!==void 0?e.imageLoadFunction:Be;super({attributions:e.attributions,interpolate:e.interpolate,projection:Le(e.projection)}),this.url_=e.url,this.imageExtent_=e.imageExtent,this.image=null,this.image=new V(this.imageExtent_,void 0,1,$e({url:e.url,imageExtent:e.imageExtent,crossOrigin:t,load:(s,r)=>(this.image.setImage(s),i(this.image,r),ae(s))})),this.image.addEventListener(K.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(e,t,i,s){return oe(e,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}class Ke extends be{constructor(e){e=e||{},super(e)}}class qe extends Ce{constructor(e){super(e),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],i=e.pixelRatio,s=e.viewState,r=s.resolution,n=this.getLayer().getSource(),a=e.viewHints;let o=e.extent;if(t.extent!==void 0&&(o=ie(o,se(t.extent,s.projection))),!a[ne.ANIMATING]&&!a[ne.INTERACTING]&&!re(o))if(n){const c=s.projection,l=n.getImage(o,r,i,c);l&&(this.loadImage(l)?this.image_=l:l.getState()===w.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),s=Ae(t.pixelToCoordinateTransform,e.slice()),r=i.getExtent();if(r&&!Me(r,s))return null;const n=this.image_.getExtent(),a=this.image_.getImage(),o=T(n),c=Math.floor(a.width*((s[0]-n[0])/o));if(c<0||c>=a.width)return null;const l=k(n),d=Math.floor(a.height*((n[3]-s[1])/l));return d<0||d>=a.height?null:this.getImageData(a,c,d)}renderFrame(e,t){const i=this.image_,s=i.getExtent(),r=i.getResolution(),[n,a]=Array.isArray(r)?r:[r,r],o=i.getPixelRatio(),c=e.layerStatesArray[e.layerIndex],l=e.pixelRatio,d=e.viewState,g=d.center,h=d.resolution,m=l*n/(h*o),x=l*a/(h*o);this.prepareContainer(e,t);const f=this.context.canvas.width,_=this.context.canvas.height,p=this.getRenderContext(e);let E=!1,y=!0;if(c.extent){const S=se(c.extent,d.projection);y=oe(S,e.extent),E=y&&!W(S,e.extent),E&&this.clipUnrotated(p,e,S)}const I=i.getImage(),b=Te(this.tempTransform,f/2,_/2,m,x,0,o*(s[0]-g[0])/n,o*(g[1]-s[3])/a);this.renderedResolution=a*l/o;const Q=I.width*b[0],ee=I.height*b[3];if(this.getLayer().getSource().getInterpolate()||(p.imageSmoothingEnabled=!1),this.preRender(p,e),y&&Q>=.5&&ee>=.5){const S=b[4],pe=b[5],G=c.opacity;G!==1&&(p.save(),p.globalAlpha=G),p.drawImage(I,0,0,+I.width,+I.height,S,pe,Q,ee),G!==1&&p.restore()}return this.postRender(this.context,e),E&&p.restore(),p.imageSmoothingEnabled=!0,this.container}}class Z extends Ke{constructor(e){super(e)}createRenderer(){return new qe(this)}getData(e){return super.getData(e)}}function Xe(u,e,t,i,s,r){const n=[e.lon,e.lat],a=new M({geometry:new P(v(n))});return a.setStyle(new q({image:new ke({src:i,rotation:t})})),de(u,a,n,s,r)}function Ye(u,e,t,i){const s={north:parseFloat(e.north),east:parseFloat(e.east),south:parseFloat(e.south),west:parseFloat(e.west)},r=new M({geometry:new De([[v([s.west,s.north]),v([s.east,s.north]),v([s.east,s.south]),v([s.west,s.south]),v([s.west,s.north])]])});r.setStyle(new q({stroke:new le({color:"#b833ff",width:2}),fill:new ce({color:"#b833ff22"})}));const n=[(s.east+s.west)/2,(s.north+s.south)/2];return de(u,r,n,t,i)}function de(u,e,t,i,s){const r=new O({source:new U({format:new Fe,url:i})}),n=new F({target:u,layers:[new ue({source:new he({attributions:["Powered by Esri","Source: Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community"],url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",maxZoom:20})}),r,new O({source:new U({features:[e]})})],view:new L({center:v(t),zoom:14})});return n.on("click",function(a){const o=n.getEventPixel(a.originalEvent),c=[];n.forEachFeatureAtPixel(o,l=>{c.push({path:l.get("path"),url:l.get("url")})}),s(c)}),n.on("pointermove",function(a){if(a.dragging)return;n.getTargetElement().style.cursor="";const o=n.getEventPixel(a.originalEvent);n.forEachFeatureAtPixel(o,c=>{if(c.get("path")&&c.get("url"))return n.getTargetElement().style.cursor="pointer",!0})}),n}const et={pin:Xe,box:Ye},j="units",ze=[1,2,5],R=25.4/.28;class me extends X{constructor(e){e=e||{};const t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;const i=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=i+"-inner",this.element.className=i+" "+Ge,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(j,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(j)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(j,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=e.center,i=e.projection,s=this.getUnits(),r=s=="degrees"?"degrees":"m";let n=H(i,e.resolution,t,r);const a=this.minWidth_*(this.dpi_||R)/R,o=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||R)/R:void 0;let c=a*n,l="";if(s=="degrees"){const E=Ne.degrees;c*=E,c<E/60?(l="窶ｳ",n*=3600):c<E?(l="窶ｲ",n*=60):l="ﾂｰ"}else if(s=="imperial")c<.9144?(l="in",n/=.0254):c<1609.344?(l="ft",n/=.3048):(l="mi",n/=1609.344);else if(s=="nautical")n/=1852,l="NM";else if(s=="metric")c<1e-6?(l="nm",n*=1e9):c<.001?(l="ﾎｼm",n*=1e6):c<1?(l="mm",n*=1e3):c<1e3?l="m":(l="km",n/=1e3);else if(s=="us")c<.9144?(l="in",n*=39.37):c<1609.344?(l="ft",n/=.30480061):(l="mi",n/=1609.3472);else throw new Error("Invalid units");let d=3*Math.floor(Math.log(a*n)/Math.log(10)),g,h,m,x,f,_;for(;;){m=Math.floor(d/3);const E=Math.pow(10,m);if(g=ze[(d%3+3)%3]*E,h=Math.round(g/n),isNaN(h)){this.element.style.display="none",this.renderedVisible_=!1;return}if(o!==void 0&&h>=o){g=x,h=f,m=_;break}else if(h>=a)break;x=g,f=h,_=m,++d}const p=this.scaleBar_?this.createScaleBar(h,g,l):g.toFixed(m<0?-m:0)+" "+l;this.renderedHTML_!=p&&(this.innerElement_.innerHTML=p,this.renderedHTML_=p),this.renderedWidth_!=h&&(this.innerElement_.style.width=h+"px",this.renderedWidth_=h),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,i){const s=this.getScaleForResolution(),r=s<1?Math.round(1/s).toLocaleString()+" : 1":"1 : "+Math.round(s).toLocaleString(),n=this.scaleBarSteps_,a=e/n,o=[this.createMarker("absolute")];for(let l=0;l<n;++l){const d=l%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";o.push(`<div><div class="ol-scale-singlebar ${d}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(l%2===0||n===2?this.createStepText(l,e,!1,t,i):"")+"</div>")}return o.push(this.createStepText(n,e,!0,t,i)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+r+"</div>":"")+o.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,t,i,s,r){const a=(e===0?0:Math.round(s/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+r),o=e===0?-3:t/this.scaleBarSteps_*-1,c=e===0?0:t/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${o}px;text-align: ${e===0?"left":"center"};min-width: ${c}px;left: ${i?t+"px":"unset"};">`+a+"</div>"}getScaleForResolution(){const e=H(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),t=this.dpi_||R,i=1e3/25.4;return e*i*t}render(e){const t=e.frameState;t?this.viewState_=t.viewState:this.viewState_=null,this.updateElement_()}}function Ze(){const u=document.createElement("button");u.innerHTML="Noﾅemt visus marﾄｷierus",u.style.width="unset",u.style.fontWeight="unset";const e=document.createElement("div");e.className="ol-unselectable ol-control",e.style.right=".5em",e.style.bottom=".5em",e.style.display="none",e.appendChild(u);const t=new X({element:e});return{button:u,element:e,control:t}}function J(){const u=new U,e=Ze(),t=new O({source:u,style:new q({image:new je({radius:15,fill:new ce({color:"#ff33e022"}),stroke:new le({color:"#ff33e0",width:2})})})}),i=async a=>{const o=await t.getFeatures(a.pixel);if(o.length){o.forEach(c=>u.removeFeature(c));return}u.addFeature(new M(new P(a.coordinate))),e.element.style.display="block"},s=async a=>await t.getFeatures(a.pixel),r=()=>u.getFeatures().map(a=>a.getGeometry().getCoordinates()),n=a=>a.forEach(o=>u.addFeature(new M(new P(o))));return e.button.addEventListener("click",()=>{u.clear(!0),e.element.style.display="none"}),{layer:t,removeClicked:i,getClickedFeatures:s,getMarkers:r,addMarkers:n,clearControl:e.control}}function tt(u,e,t,i=!0){e=[0,0,e[0],e[1]];const s=new We({code:"this-image",units:"pixels",extent:e}),r=J(),n=new F({controls:Y().extend([...i?[r.clearControl]:[]]),layers:[new Z({source:new z({url:t,projection:s,imageExtent:e})}),r.layer],target:u,view:new L({projection:s,center:$(e),extent:e,showFullExtent:!0,zoom:1})});n.getView().fit(e);const a=async o=>{const c=await r.layer.getFeatures(o.pixel);n.getTargetElement().style.cursor=c.length?"pointer":""};return i?(n.on("click",r.removeClicked),n.on("pointermove",a),n.on("click",o=>setTimeout(c=>a(o),10))):n.on("click",async o=>{const c=await r.getClickedFeatures(o),l=[];c.forEach(g=>{l.push(g.getGeometry().getCoordinates())});const d=new D("gotcoords");d.payload="Koordinﾄ》as (pikseﾄｼos nevis ﾄｫstﾄ《):<br>"+l.map(g=>g[1]+","+g[0]).join("<br>"),n.dispatchEvent(d)}),{map:n,userMarkers:r}}function st(u,e,t,i=!0){const s=Pe([parseFloat(e.west),parseFloat(e.south),parseFloat(e.east),parseFloat(e.north)],"EPSG:4326","EPSG:3857"),r=J(),n=new me({units:"metric",bar:!0,steps:4,text:!1,minWidth:140}),a=new F({controls:Y().extend([n,...i?[r.clearControl]:[]]),layers:[new ue({source:new he({attributions:["Powered by Esri","Source: Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community"],url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",maxZoom:20})}),new Z({source:new z({url:t,imageExtent:s})}),r.layer],target:u,view:new L});a.getView().fit(s);const o=async c=>{const l=await r.layer.getFeatures(c.pixel);a.getTargetElement().style.cursor=l.length?"pointer":""};return i?(a.on("click",r.removeClicked),a.on("pointermove",o),a.on("click",c=>setTimeout(l=>o(c),10))):a.on("click",async c=>{const l=await r.getClickedFeatures(c),d=[];l.forEach(h=>{d.push(ge(h.getGeometry().getCoordinates()))});const g=new D("gotcoords");g.payload="Koordinﾄ》as:<br>"+d.map(h=>h[1]+","+h[0]).join("<br>"),a.dispatchEvent(g)}),{map:a,userMarkers:r}}function Je(){const u=document.createElement("button"),e=document.createElement("div");e.className="ol-unselectable ol-control",e.style.right=".5em",e.style.top=".5em",e.appendChild(u);const t=new X({element:e});return{button:u,control:t}}function nt(u,e,t,i,s,r=!0,n=!1){e=v(e);const a=new L({center:e}),o=n?.83236:H(a.getProjection(),1,e);i=[e[0]-i[0]/2/o,e[1]-i[1]/2/o,e[0]+i[0]/2/o,e[1]+i[1]/2/o];const c=new L({extent:i,showFullExtent:!0}),l=J(),d=new me({units:"metric",bar:!0,steps:4,text:!1,minWidth:160}),g=Je();let h=window.sessionStorage.getItem("view-type")==="extent"?a:c;g.button.innerHTML=window.sessionStorage.getItem("view-type")==="extent"?"沐ｲ":"沐ｳ";const m=new F({controls:Y().extend([d,g.control,...r?[l.clearControl]:[]]),layers:[new Z({source:new z({url:s,imageExtent:i})}),l.layer],target:u,view:h});h.fit(i),g.button.addEventListener("click",f=>{h===a?(g.button.innerHTML="沐ｳ",window.sessionStorage.setItem("view-type","extent"),h=c):(g.button.innerHTML="沐ｲ",window.sessionStorage.setItem("view-type","free"),h=a),m.setView(h),h.fit(i)});const x=async f=>{const _=await l.layer.getFeatures(f.pixel);m.getTargetElement().style.cursor=_.length?"pointer":""};return r?(m.on("click",l.removeClicked),m.on("pointermove",x),m.on("click",f=>setTimeout(_=>x(f),10))):m.on("click",async f=>{const _=await l.getClickedFeatures(f);if(!_.length)return;const p=[];_.forEach(y=>{const I=y.getGeometry().clone();I.rotate(-t*Math.PI/180,e),p.push(ge(I.getCoordinates()))});const E=new D("gotcoords");E.payload="Koordinﾄ》as:<br>"+p.map(y=>y[1]+","+y[0]).join("<br>"),m.dispatchEvent(E)}),{map:m,userMarkers:l}}export{st as a,nt as b,tt as d,et as m};
