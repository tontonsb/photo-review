import{I as B,c as ne,d as V,e as me,h as pe,i as ie,j as f,k as T,l as C,r as fe,m as we,E as $,u as _e,n as Ee,S as xe,o as ye,p as ee,q as Ie,s as W,t as b,v as Se,B as ve,w as re,x as Re,y as ae,L as Le,C as be,z as te,A as se,D as Ae,F as Me,H as Te,J as M,K as j,f as x,N as q,O as Ce,P as De,Q as oe,R as le,b as P,V as O,G as Ge,M as D,T as ce,X as ue,a as R,U as X,W as ke,g as H,Y as Fe,Z as Ne,_ as Y,$ as We,a0 as je}from"./XYZ-Cu8nJpgV.js";function U(l){return Array.isArray(l)?Math.min(...l):l}class Pe extends B{constructor(e,t,i,n,r,s,a){let c=e.getExtent();c&&e.canWrapX()&&(c=c.slice(),c[0]=-1/0,c[2]=1/0);let o=t.getExtent();o&&t.canWrapX()&&(o=o.slice(),o[0]=-1/0,o[2]=1/0);const u=o?ne(i,o):i,h=V(u),d=me(e,t,h,n),g=Ee,p=new pe(e,t,u,c,d*g,n),w=p.calculateSourceExtent(),_=ie(w)?null:s(w,d,r),y=_?f.IDLE:f.EMPTY,m=_?_.getPixelRatio():1;super(i,n,m,y),this.targetProj_=t,this.maxSourceExtent_=c,this.triangulation_=p,this.targetResolution_=n,this.targetExtent_=i,this.sourceImage_=_,this.sourcePixelRatio_=m,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==f.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==f.LOADED){const t=T(this.targetExtent_)/this.targetResolution_,i=C(this.targetExtent_)/this.targetResolution_;this.canvas_=fe(t,i,this.sourcePixelRatio_,U(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=e,this.changed()}load(){if(this.state==f.IDLE){this.state=f.LOADING,this.changed();const e=this.sourceImage_.getState();e==f.LOADED||e==f.ERROR?this.reproject_():(this.sourceListenerKey_=we(this.sourceImage_,$.CHANGE,function(t){const i=this.sourceImage_.getState();(i==f.LOADED||i==f.ERROR)&&(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}}unlistenSource_(){_e(this.sourceListenerKey_),this.sourceListenerKey_=null}}const A=4,F={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class Oe extends ve{constructor(e,t){super(e),this.image=t}}class He extends xe{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:e.interpolate!==void 0?e.interpolate:!0}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=e.resolutions!==void 0?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=e.loader?e.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const t=this.getResolutions();if(t){const i=ye(t,e,0);e=t[i]}return e}getImage(e,t,i,n){const r=this.getProjection();if(!r||!n||ee(r,n))return r&&(n=r),this.getImageInternal(e,t,i,n);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&ee(this.reprojectedImage_.getProjection(),n)&&this.reprojectedImage_.getResolution()==t&&Ie(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new Pe(r,n,e,t,i,(s,a,c)=>this.getImageInternal(s,a,c,r),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,t,i,n){if(this.loader){const r=Be(e,t,i,1),s=this.findNearestResolution(t);if(this.image&&(this.static_||this.wantedProjection_===n&&(this.wantedExtent_&&W(this.wantedExtent_,r)||W(this.image.getExtent(),r))&&(this.wantedResolution_&&U(this.wantedResolution_)===s||U(this.image.getResolution())===s)))return this.image;this.wantedProjection_=n,this.wantedExtent_=r,this.wantedResolution_=s,this.image=new B(r,s,i,this.loader),this.image.addEventListener($.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){const t=e.target;let i;switch(t.getState()){case f.LOADING:this.loading=!0,i=F.IMAGELOADSTART;break;case f.LOADED:this.loading=!1,i=F.IMAGELOADEND;break;case f.ERROR:this.loading=!1,i=F.IMAGELOADERROR;break;default:return}this.hasListener(i)&&this.dispatchEvent(new Oe(i,t))}}function Ue(l,e){l.getImage().src=e}function Be(l,e,t,i){const n=e/t,r=V(l),s=b(T(l)/n,A),a=b(C(l)/n,A),c=b((i-1)*s/2,A),o=s+2*c,u=b((i-1)*a/2,A),h=a+2*u;return Se(r,n,0,[o,h])}function Ve(l){const e=l.load||re,t=l.imageExtent,i=new Image;return l.crossOrigin!==null&&(i.crossOrigin=l.crossOrigin),()=>e(i,l.url).then(n=>{const r=T(t)/n.width,s=C(t)/n.height;return{image:n,extent:t,resolution:r!==s?[r,s]:s,pixelRatio:1}})}class z extends He{constructor(e){const t=e.crossOrigin!==void 0?e.crossOrigin:null,i=e.imageLoadFunction!==void 0?e.imageLoadFunction:Ue;super({attributions:e.attributions,interpolate:e.interpolate,projection:Re(e.projection)}),this.url_=e.url,this.imageExtent_=e.imageExtent,this.image=null,this.image=new B(this.imageExtent_,void 0,1,Ve({url:e.url,imageExtent:e.imageExtent,crossOrigin:t,load:(n,r)=>(this.image.setImage(n),i(this.image,r),re(n))})),this.image.addEventListener($.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(e,t,i,n){return ae(e,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}class $e extends Le{constructor(e){e=e||{},super(e)}}class qe extends be{constructor(e){super(e),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],i=e.pixelRatio,n=e.viewState,r=n.resolution,s=this.getLayer().getSource(),a=e.viewHints;let c=e.extent;if(t.extent!==void 0&&(c=ne(c,te(t.extent,n.projection))),!a[se.ANIMATING]&&!a[se.INTERACTING]&&!ie(c))if(s){const o=n.projection,u=s.getImage(c,r,i,o);u&&(this.loadImage(u)?this.image_=u:u.getState()===f.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),n=Ae(t.pixelToCoordinateTransform,e.slice()),r=i.getExtent();if(r&&!Me(r,n))return null;const s=this.image_.getExtent(),a=this.image_.getImage(),c=T(s),o=Math.floor(a.width*((n[0]-s[0])/c));if(o<0||o>=a.width)return null;const u=C(s),h=Math.floor(a.height*((s[3]-n[1])/u));return h<0||h>=a.height?null:this.getImageData(a,o,h)}renderFrame(e,t){const i=this.image_,n=i.getExtent(),r=i.getResolution(),[s,a]=Array.isArray(r)?r:[r,r],c=i.getPixelRatio(),o=e.layerStatesArray[e.layerIndex],u=e.pixelRatio,h=e.viewState,d=h.center,g=h.resolution,p=u*s/(g*c),w=u*a/(g*c);this.prepareContainer(e,t);const _=this.context.canvas.width,y=this.context.canvas.height,m=this.getRenderContext(e);let E=!1,G=!0;if(o.extent){const S=te(o.extent,h.projection);G=ae(S,e.extent),E=G&&!W(S,e.extent),E&&this.clipUnrotated(m,e,S)}const I=i.getImage(),L=Te(this.tempTransform,_/2,y/2,p,w,0,c*(n[0]-d[0])/s,c*(d[1]-n[3])/a);this.renderedResolution=a*u/c;const J=I.width*L[0],Q=I.height*L[3];if(this.getLayer().getSource().getInterpolate()||(m.imageSmoothingEnabled=!1),this.preRender(m,e),G&&J>=.5&&Q>=.5){const S=L[4],de=L[5],k=o.opacity;k!==1&&(m.save(),m.globalAlpha=k),m.drawImage(I,0,0,+I.width,+I.height,S,de,J,Q),k!==1&&m.restore()}return this.postRender(this.context,e),E&&m.restore(),m.imageSmoothingEnabled=!0,this.container}}class K extends $e{constructor(e){super(e)}createRenderer(){return new qe(this)}getData(e){return super.getData(e)}}function Xe(l,e,t,i,n,r){const s=[e.lon,e.lat],a=new M({geometry:new j(x(s))});return a.setStyle(new q({image:new Ce({src:i,rotation:t})})),he(l,a,s,n,r)}function Ye(l,e,t,i){const n={north:parseFloat(e.north),east:parseFloat(e.east),south:parseFloat(e.south),west:parseFloat(e.west)},r=new M({geometry:new De([[x([n.west,n.north]),x([n.east,n.north]),x([n.east,n.south]),x([n.west,n.south]),x([n.west,n.north])]])});r.setStyle(new q({stroke:new oe({color:"#b833ff",width:2}),fill:new le({color:"#b833ff22"})}));const s=[(n.east+n.west)/2,(n.north+n.south)/2];return he(l,r,s,t,i)}function he(l,e,t,i,n){const r=new P({source:new O({format:new Ge,url:i})}),s=new D({target:l,layers:[new ce({source:new ue({attributions:["Powered by Esri","Source: Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community"],url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",maxZoom:20})}),r,new P({source:new O({features:[e]})})],view:new R({center:x(t),zoom:14})});return s.on("click",function(a){const c=s.getEventPixel(a.originalEvent),o=[];s.forEachFeatureAtPixel(c,u=>{o.push({path:u.get("path"),url:u.get("url")})}),n(o)}),s.on("pointermove",function(a){if(a.dragging)return;s.getTargetElement().style.cursor="";const c=s.getEventPixel(a.originalEvent);s.forEachFeatureAtPixel(c,o=>{if(o.get("path")&&o.get("url"))return s.getTargetElement().style.cursor="pointer",!0})}),s}const Qe={pin:Xe,box:Ye},N="units",ze=[1,2,5],v=25.4/.28;class ge extends X{constructor(e){e=e||{};const t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;const i=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=i+"-inner",this.element.className=i+" "+ke,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(N,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(N)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(N,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=e.center,i=e.projection,n=this.getUnits(),r=n=="degrees"?"degrees":"m";let s=H(i,e.resolution,t,r);const a=this.minWidth_*(this.dpi_||v)/v,c=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||v)/v:void 0;let o=a*s,u="";if(n=="degrees"){const E=Fe.degrees;o*=E,o<E/60?(u="â€³",s*=3600):o<E?(u="â€²",s*=60):u="Â°"}else if(n=="imperial")o<.9144?(u="in",s/=.0254):o<1609.344?(u="ft",s/=.3048):(u="mi",s/=1609.344);else if(n=="nautical")s/=1852,u="NM";else if(n=="metric")o<1e-6?(u="nm",s*=1e9):o<.001?(u="Î¼m",s*=1e6):o<1?(u="mm",s*=1e3):o<1e3?u="m":(u="km",s/=1e3);else if(n=="us")o<.9144?(u="in",s*=39.37):o<1609.344?(u="ft",s/=.30480061):(u="mi",s/=1609.3472);else throw new Error("Invalid units");let h=3*Math.floor(Math.log(a*s)/Math.log(10)),d,g,p,w,_,y;for(;;){p=Math.floor(h/3);const E=Math.pow(10,p);if(d=ze[(h%3+3)%3]*E,g=Math.round(d/s),isNaN(g)){this.element.style.display="none",this.renderedVisible_=!1;return}if(c!==void 0&&g>=c){d=w,g=_,p=y;break}else if(g>=a)break;w=d,_=g,y=p,++h}const m=this.scaleBar_?this.createScaleBar(g,d,u):d.toFixed(p<0?-p:0)+" "+u;this.renderedHTML_!=m&&(this.innerElement_.innerHTML=m,this.renderedHTML_=m),this.renderedWidth_!=g&&(this.innerElement_.style.width=g+"px",this.renderedWidth_=g),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,i){const n=this.getScaleForResolution(),r=n<1?Math.round(1/n).toLocaleString()+" : 1":"1 : "+Math.round(n).toLocaleString(),s=this.scaleBarSteps_,a=e/s,c=[this.createMarker("absolute")];for(let u=0;u<s;++u){const h=u%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";c.push(`<div><div class="ol-scale-singlebar ${h}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(u%2===0||s===2?this.createStepText(u,e,!1,t,i):"")+"</div>")}return c.push(this.createStepText(s,e,!0,t,i)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+r+"</div>":"")+c.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,t,i,n,r){const a=(e===0?0:Math.round(n/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+r),c=e===0?-3:t/this.scaleBarSteps_*-1,o=e===0?0:t/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${c}px;text-align: ${e===0?"left":"center"};min-width: ${o}px;left: ${i?t+"px":"unset"};">`+a+"</div>"}getScaleForResolution(){const e=H(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),t=this.dpi_||v,i=1e3/25.4;return e*i*t}render(e){const t=e.frameState;t?this.viewState_=t.viewState:this.viewState_=null,this.updateElement_()}}function Ke(){const l=document.createElement("button");l.innerHTML="NoÅ†emt visus marÄ·ierus",l.style.width="unset",l.style.fontWeight="unset";const e=document.createElement("div");e.className="ol-unselectable ol-control",e.style.right=".5em",e.style.bottom=".5em",e.style.display="none",e.appendChild(l);const t=new X({element:e});return{button:l,element:e,control:t}}function Z(){const l=new O,e=Ke(),t=new P({source:l,style:new q({image:new Ne({radius:15,fill:new le({color:"#ff33e022"}),stroke:new oe({color:"#ff33e0",width:2})})})}),i=async s=>{const a=await t.getFeatures(s.pixel);if(a.length){a.forEach(c=>l.removeFeature(c));return}l.addFeature(new M(new j(s.coordinate))),e.element.style.display="block"},n=()=>l.getFeatures().map(s=>s.getGeometry().getCoordinates()),r=s=>s.forEach(a=>l.addFeature(new M(new j(a))));return e.button.addEventListener("click",()=>{l.clear(!0),e.element.style.display="none"}),{layer:t,clickHandler:i,getMarkers:n,addMarkers:r,clearControl:e.control}}function et(l,e,t,i=!0){e=[0,0,e[0],e[1]];const n=new We({code:"this-image",units:"pixels",extent:e}),r=Z(),s=new D({controls:Y().extend([...i?[r.clearControl]:[]]),layers:[new K({source:new z({url:t,projection:n,imageExtent:e})}),r.layer],target:l,view:new R({projection:n,center:V(e),extent:e,showFullExtent:!0,zoom:1})});s.getView().fit(e);const a=async c=>{const o=await r.layer.getFeatures(c.pixel);s.getTargetElement().style.cursor=o.length?"pointer":""};return i&&(s.on("click",r.clickHandler),s.on("pointermove",a),s.on("click",c=>setTimeout(o=>a(c),10))),{map:s,userMarkers:r}}function tt(l,e,t,i=!0){const n=je([parseFloat(e.west),parseFloat(e.south),parseFloat(e.east),parseFloat(e.north)],"EPSG:4326","EPSG:3857"),r=Z(),s=new ge({units:"metric",bar:!0,steps:4,text:!1,minWidth:140}),a=new D({controls:Y().extend([s,...i?[r.clearControl]:[]]),layers:[new ce({source:new ue({attributions:["Powered by Esri","Source: Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community"],url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",maxZoom:20})}),new K({source:new z({url:t,imageExtent:n})}),r.layer],target:l,view:new R});a.getView().fit(n);const c=async o=>{const u=await r.layer.getFeatures(o.pixel);a.getTargetElement().style.cursor=u.length?"pointer":""};return i&&(a.on("click",r.clickHandler),a.on("pointermove",c),a.on("click",o=>setTimeout(u=>c(o),10))),{map:a,userMarkers:r}}function Ze(){const l=document.createElement("button"),e=document.createElement("div");e.className="ol-unselectable ol-control",e.style.right=".5em",e.style.top=".5em",e.appendChild(l);const t=new X({element:e});return{button:l,control:t}}function st(l,e,t,i,n=!0,r=!1){e=x(e);const s=new R({center:e}),a=r?.83236:H(s.getProjection(),1,e);t=[e[0]-t[0]/2/a,e[1]-t[1]/2/a,e[0]+t[0]/2/a,e[1]+t[1]/2/a];const c=new R({extent:t,showFullExtent:!0}),o=Z(),u=new ge({units:"metric",bar:!0,steps:4,text:!1,minWidth:160}),h=Ze();let d=window.sessionStorage.getItem("view-type")==="extent"?s:c;h.button.innerHTML=window.sessionStorage.getItem("view-type")==="extent"?"ðŸ”²":"ðŸ”³";const g=new D({controls:Y().extend([u,h.control,...n?[o.clearControl]:[]]),layers:[new K({source:new z({url:i,imageExtent:t})}),o.layer],target:l,view:d});d.fit(t),h.button.addEventListener("click",w=>{d===s?(h.button.innerHTML="ðŸ”³",window.sessionStorage.setItem("view-type","extent"),d=c):(h.button.innerHTML="ðŸ”²",window.sessionStorage.setItem("view-type","free"),d=s),g.setView(d),d.fit(t)});const p=async w=>{const _=await o.layer.getFeatures(w.pixel);g.getTargetElement().style.cursor=_.length?"pointer":""};return n&&(g.on("click",o.clickHandler),g.on("pointermove",p),g.on("click",w=>setTimeout(_=>p(w),10))),{map:g,userMarkers:o}}export{tt as a,st as b,et as d,Qe as m};
